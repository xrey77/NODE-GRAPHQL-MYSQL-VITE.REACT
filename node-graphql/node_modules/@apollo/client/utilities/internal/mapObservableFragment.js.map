{"version":3,"file":"mapObservableFragment.js","sourceRoot":"","sources":["../../../src/utilities/internal/mapObservableFragment.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,GAAG,EAAE,WAAW,EAAE,MAAM,MAAM,CAAC;AAIxC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AAEvC,SAAS,qBAAqB,CAC5B,UAAgD,EAChD,KAEwC;IAExC,IAAI,aAAoD,CAAC;IACzD,IAAI,kBAAuD,CAAC;IAE5D,SAAS,QAAQ,CACf,MAA6C;QAE7C,IAAI,MAAM,KAAK,aAAa,EAAE,CAAC;YAC7B,aAAa,GAAG,MAAM,CAAC;YACvB,kBAAkB,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;QAC5C,CAAC;QACD,OAAO,kBAAkB,CAAC;IAC5B,CAAC;IAED,OAAO,MAAM,CAAC,MAAM,CAClB,UAAU,CAAC,IAAI,CACb,GAAG,CAAC,QAAQ,CAAC,EACb,WAAW,CAAC,EAAE,UAAU,EAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAC/C,EACD;QACE,gBAAgB,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,UAAU,CAAC,gBAAgB,EAAE,CAAC;KAChE,CACF,CAAC;AACJ,CAAC;AAED,MAAM,CAAC,MAAM,6BAA6B,GAAG,OAAO,CAClD,SAAS,6BAA6B,CACpC,UAAgD;AAChD;;GAEG;AACH,SAAiB,EACjB,KAEwC;IAExC,OAAO,qBAAqB,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;AAClD,CAAC,EACD,EAAE,GAAG,EAAE,CAAC,EAAE,YAAY,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CACrD,CAAC","sourcesContent":["import { map, shareReplay } from \"rxjs\";\n\nimport type { ApolloCache } from \"@apollo/client\";\n\nimport { memoize } from \"./memoize.js\";\n\nfunction mapObservableFragment<From, To>(\n  observable: ApolloCache.ObservableFragment<From>,\n  mapFn: (\n    from: ApolloCache.WatchFragmentResult<From>\n  ) => ApolloCache.WatchFragmentResult<To>\n): ApolloCache.ObservableFragment<To> {\n  let currentResult: ApolloCache.WatchFragmentResult<From>;\n  let stableMappedResult: ApolloCache.WatchFragmentResult<To>;\n\n  function toMapped(\n    result: ApolloCache.WatchFragmentResult<From>\n  ): ApolloCache.WatchFragmentResult<To> {\n    if (result !== currentResult) {\n      currentResult = result;\n      stableMappedResult = mapFn(currentResult);\n    }\n    return stableMappedResult;\n  }\n\n  return Object.assign(\n    observable.pipe(\n      map(toMapped),\n      shareReplay({ bufferSize: 1, refCount: true })\n    ),\n    {\n      getCurrentResult: () => toMapped(observable.getCurrentResult()),\n    }\n  );\n}\n\nexport const mapObservableFragmentMemoized = memoize(\n  function mapObservableFragmentMemoized<From, To>(\n    observable: ApolloCache.ObservableFragment<From>,\n    /**\n     * used together with `observable` as memoization key, `mapFn` is explicitly not used as memoization key\n     */\n    _cacheKey: symbol,\n    mapFn: (\n      from: ApolloCache.WatchFragmentResult<From>\n    ) => ApolloCache.WatchFragmentResult<To>\n  ): ApolloCache.ObservableFragment<To> {\n    return mapObservableFragment(observable, mapFn);\n  },\n  { max: 1, makeCacheKey: (args) => args.slice(0, 2) }\n);\n"]}
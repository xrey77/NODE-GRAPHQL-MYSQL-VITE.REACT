{"version":3,"file":"memoize.js","sourceRoot":"","sources":["../../../src/utilities/internal/memoize.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAE,MAAM,WAAW,CAAC;AAEjC,OAAO,EAAE,oBAAoB,EAAE,MAAM,aAAa,CAAC;AAEnD;;GAEG;AACH,MAAM,UAAU,OAAO,CACrB,EAA+B,EAC/B,EACE,GAAG,EACH,YAAY,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,GAC+B;IAE9D,MAAM,IAAI,GAAG,IAAI,IAAI,CAAK,IAAI,CAAC,CAAC;IAChC,MAAM,KAAK,GAAG,IAAI,oBAAoB,CAGpC,GAAG,CAAC,CAAC;IAEP,OAAO,CAAC,GAAG,IAAW,EAAW,EAAE;QACjC,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;QACtD,MAAM,MAAM,GAAG,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACnC,IAAI,MAAM,EAAE,CAAC;YACX,IAAI,MAAM,CAAC,KAAK,EAAE,CAAC;gBACjB,MAAM,MAAM,CAAC,KAAK,CAAC;YACrB,CAAC;YACD,OAAO,MAAM,CAAC,MAAO,CAAC;QACxB,CAAC;QAED,MAAM,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;QACtC,IAAI,CAAC;YACH,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;QACtC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;YACpB,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC,CAAC;AACJ,CAAC","sourcesContent":["import { Trie } from \"@wry/trie\";\n\nimport { AutoCleanedWeakCache } from \"./caches.js\";\n\n/**\n * Naive alternative to `wrap` without any dependency tracking, potentially avoiding resulting memory leaks.\n */\nexport function memoize<TArgs extends any[], TResult>(\n  fn: (...args: TArgs) => TResult,\n  {\n    max,\n    makeCacheKey = (args) => args,\n  }: { max: number; makeCacheKey?: (args: TArgs) => [...any[]] }\n): (...args: TArgs) => TResult {\n  const keys = new Trie<{}>(true);\n  const cache = new AutoCleanedWeakCache<\n    {},\n    { result?: TResult; error?: unknown }\n  >(max);\n\n  return (...args: TArgs): TResult => {\n    const cacheKey = keys.lookupArray(makeCacheKey(args));\n    const cached = cache.get(cacheKey);\n    if (cached) {\n      if (cached.error) {\n        throw cached.error;\n      }\n      return cached.result!;\n    }\n\n    const entry = cache.set(cacheKey, {});\n    try {\n      return (entry.result = fn(...args));\n    } catch (error) {\n      entry.error = error;\n      throw error;\n    }\n  };\n}\n"]}
"use strict";var b=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var k=(t,e)=>{for(var n in e)b(t,n,{get:e[n],enumerable:!0})},H=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of D(e))!E.call(t,i)&&i!==n&&b(t,i,{get:()=>e[i],enumerable:!(a=A(e,i))||a.enumerable});return t};var B=t=>H(b({},"__esModule",{value:!0}),t);var z={};k(z,{TOTP:()=>d,generate:()=>O,generateSync:()=>v,getRemainingTime:()=>N,getTimeStepUsed:()=>j,verify:()=>S,verifySync:()=>L,wrapResult:()=>h.wrapResult,wrapResultAsync:()=>h.wrapResultAsync});module.exports=B(z);var r=require("@otplib/core"),y=require("@otplib/hotp");var u=require("@otplib/core"),C=require("@otplib/uri");var d=class{options;guardrails;constructor(e={}){this.options=e,this.guardrails=(0,u.createGuardrails)(e.guardrails)}generateSecret(){let{crypto:e,base32:n}=this.options;return(0,u.requireCryptoPlugin)(e),(0,u.requireBase32Plugin)(n),(0,u.generateSecret)({crypto:e,base32:n})}async generate(e){let n={...this.options,...e},{secret:a,crypto:i,base32:s,algorithm:l="sha1",digits:f=6,period:c=30,epoch:p,t0:o=0}=n;(0,u.requireSecret)(a),(0,u.requireCryptoPlugin)(i),(0,u.requireBase32Plugin)(s);let m=e?.guardrails??this.guardrails;return O({secret:a,algorithm:l,digits:f,period:c,epoch:p??Math.floor(Date.now()/1e3),t0:o,crypto:i,base32:s,guardrails:m})}async verify(e,n){let a={...this.options,...n},{secret:i,crypto:s,base32:l,algorithm:f="sha1",digits:c=6,period:p=30,epoch:o,t0:m=0,epochTolerance:T=0,afterTimeStep:g}=a;(0,u.requireSecret)(i),(0,u.requireCryptoPlugin)(s),(0,u.requireBase32Plugin)(l);let P=n?.guardrails??this.guardrails;return S({secret:i,token:e,algorithm:f,digits:c,period:p,epoch:o??Math.floor(Date.now()/1e3),t0:m,epochTolerance:T,afterTimeStep:g,crypto:s,base32:l,guardrails:P})}toURI(e){let{issuer:n,label:a,secret:i,algorithm:s="sha1",digits:l=6,period:f=30}=this.options,c=e?.label??a,p=e?.issuer??n,o=e?.secret??i;return(0,u.requireSecret)(o),(0,u.requireLabel)(c),(0,u.requireIssuer)(p),(0,u.requireBase32String)(o),(0,C.generateTOTP)({issuer:p,label:c,secret:o,algorithm:s,digits:l,period:f})}};var h=require("@otplib/core");function G(t){let{secret:e,epoch:n=Math.floor(Date.now()/1e3),t0:a=0,period:i=30,algorithm:s="sha1",digits:l=6,crypto:f,base32:c,guardrails:p=(0,r.createGuardrails)()}=t;(0,r.requireSecret)(e),(0,r.requireCryptoPlugin)(f);let o=(0,r.normalizeSecret)(e,c);(0,r.validateSecret)(o,p),(0,r.validateTime)(n),(0,r.validatePeriod)(i,p);let m=Math.floor((n-a)/i);return{secret:o,counter:m,algorithm:s,digits:l,crypto:f,guardrails:p}}async function O(t){let e=G(t);return(0,y.generate)(e)}function v(t){let e=G(t);return(0,y.generateSync)(e)}function U(t,e){if(t!==void 0){if(t<0)throw new r.AfterTimeStepNegativeError;if(!Number.isSafeInteger(t))throw new r.AfterTimeStepNotIntegerError;if(t>e)throw new r.AfterTimeStepRangeExceededError}}function V(t,e){return e!==void 0&&t<=e}function w(t){let{secret:e,token:n,epoch:a=Math.floor(Date.now()/1e3),t0:i=0,period:s=30,algorithm:l="sha1",digits:f=6,crypto:c,base32:p,epochTolerance:o=0,afterTimeStep:m,guardrails:T=(0,r.createGuardrails)()}=t;(0,r.requireSecret)(e),(0,r.requireCryptoPlugin)(c);let g=(0,r.normalizeSecret)(e,p);(0,r.validateSecret)(g,T),(0,r.validateTime)(a),(0,r.validatePeriod)(s,T),(0,r.validateToken)(n,f),(0,r.validateEpochTolerance)(o,s,T);let P=Math.floor((a-i)/s),[R,M]=(0,r.normalizeEpochTolerance)(o),I=Math.max(0,Math.floor((a-R-i)/s)),x=Math.floor((a+M-i)/s);return U(m,x),{token:n,crypto:c,minCounter:I,maxCounter:x,currentCounter:P,t0:i,period:s,afterTimeStep:m,getGenerateOptions:q=>({secret:g,epoch:q*s+i,t0:i,period:s,algorithm:l,digits:f,crypto:c,guardrails:T})}}async function S(t){let{token:e,crypto:n,minCounter:a,maxCounter:i,currentCounter:s,t0:l,period:f,afterTimeStep:c,getGenerateOptions:p}=w(t);for(let o=a;o<=i;o++){if(V(o,c))continue;let m=await O(p(o));if(n.constantTimeEqual(m,e))return{valid:!0,delta:o-s,epoch:o*f+l,timeStep:o}}return{valid:!1}}function L(t){let{token:e,crypto:n,minCounter:a,maxCounter:i,currentCounter:s,t0:l,period:f,afterTimeStep:c,getGenerateOptions:p}=w(t);for(let o=a;o<=i;o++){if(V(o,c))continue;let m=v(p(o));if(n.constantTimeEqual(m,e))return{valid:!0,delta:o-s,epoch:o*f+l,timeStep:o}}return{valid:!1}}function N(t=Math.floor(Date.now()/1e3),e=30,n=0,a=(0,r.createGuardrails)()){return(0,r.validateTime)(t),(0,r.validatePeriod)(e,a),(Math.floor((t-n)/e)+1)*e+n-t}function j(t=Math.floor(Date.now()/1e3),e=30,n=0,a=(0,r.createGuardrails)()){return(0,r.validateTime)(t),(0,r.validatePeriod)(e,a),Math.floor((t-n)/e)}0&&(module.exports={TOTP,generate,generateSync,getRemainingTime,getTimeStepUsed,verify,verifySync,wrapResult,wrapResultAsync});
//# sourceMappingURL=index.cjs.map